import{i as E}from"./interact.min-DasjzKHT.js";import{d as M,i as m,D as w,j as T,k as A,c as s,v as B,s as S,o as a,_ as W,K as N,a as c,F as u,r as v,L as z,f as $}from"./index-CU42gLE2.js";const J=["data-x","data-y","data-position-type"],O=M({__name:"CardSlot",props:{positionType:{},cardId:{}},emits:["drag-start","drag-end","card-move","card-remove"],setup(I,{emit:y}){const i=I,b=y,o=m({x:0,y:0}),h=m({x:0,y:0}),r=m(i.positionType),g=m(null);let p=null;return w(()=>i.positionType,(d,e)=>{d!==e&&(o.value={x:0,y:0})}),T(()=>{const d=g.value;d&&(p=E(d).draggable({inertia:!0,autoScroll:!1,cursorChecker(){return"grabbing"},listeners:{start(e){const n=e.target;h.value={...o.value},r.value=i.positionType,console.log(`[拖拽开始] 卡片: ${i.cardId}, 初始位置类型: ${r.value}, 初始坐标: (${h.value.x}, ${h.value.y})`),b("drag-start",i.cardId),n.style.zIndex="2000",n.style.opacity="0.8",n.style.transition="none"},move(e){o.value.x+=e.dx,o.value.y+=e.dy,console.log(`[拖拽移动] 卡片: ${i.cardId}, 移动距离: (${e.dx}, ${e.dy}), 新坐标: (${o.value.x}, ${o.value.y})`)},end(e){const n=e.target,t=e.clientX,f=e.clientY;console.log(`[拖拽结束] 卡片: ${i.cardId}, 释放屏幕坐标: (${t}, ${f})`);const x=document.querySelectorAll(".game-section.hand-section");let C=!1;for(const D of x){const l=D.getBoundingClientRect();if(console.log(`[区域检查] 手牌区域坐标: 左=${l.left}, 右=${l.right}, 上=${l.top}, 下=${l.bottom}`),t>=l.left&&t<=l.right&&f>=l.top&&f<=l.bottom){C=!0,console.log(`[区域检查] 卡片 ${i.cardId} 释放到手牌区域内`);break}}const R=document.querySelectorAll(".game-section.tavern-section");let k=!1;for(const D of R){const l=D.getBoundingClientRect();if(console.log(`[区域检查] 酒馆区域坐标: 左=${l.left}, 右=${l.right}, 上=${l.top}, 下=${l.bottom}`),t>=l.left&&t<=l.right&&f>=l.top&&f<=l.bottom){k=!0,console.log(`[区域检查] 卡片 ${i.cardId} 释放到酒馆区域内`);break}}if(b("drag-end",i.cardId,C?"hand":k?"tavern":null),k&&r.value==="战场"){console.log(`[位置更新] 战场卡片 ${i.cardId} 拖拽到酒馆区域，卡片消失`),b("card-remove",i.cardId);return}C&&r.value==="酒馆"?(console.log(`[位置更新] 卡片 ${i.cardId} 从 ${r.value} 移动到手牌区域`),b("card-move",i.cardId,r.value,"手牌"),o.value={x:0,y:0},console.log(`[位置更新] 卡片 ${i.cardId} 位置重置为 (0, 0)`)):(console.log(`[位置更新] 卡片 ${i.cardId} 回到初始位置: (${h.value.x}, ${h.value.y})`),o.value={...h.value}),n.style.zIndex="",n.style.opacity="1",n.style.transition="transform 0.1s ease, opacity 0.2s ease"}}}))}),A(()=>{p&&p.unset()}),(d,e)=>(a(),s("div",{ref_key:"cardRef",ref:g,class:S(["card-slot",`position-${i.positionType}`]),"data-x":o.value.x,"data-y":o.value.y,"data-position-type":i.positionType,style:B({transform:`translate(${o.value.x}px, ${o.value.y}px)`})},null,14,J))}}),_=W(O,[["__scopeId","data-v-f68ceb6b"]]),P={class:"vertical-hearthstone"},q={class:"game-container"},F={class:"card-row"},L={class:"card-row"},V={class:"game-section battlefield-section"},X={class:"card-row"},Y={class:"card-row"},j={class:"card-row"},H={class:"card-row"},K=M({__name:"index",setup(I){const y=m(!1),i=m(!1),b=m(null),o=N([]);(()=>{for(let e=1;e<=5;e++)o.push({id:`tavern-1-${e}`,position:"酒馆"});for(let e=1;e<=2;e++)o.push({id:`tavern-2-${e}`,position:"酒馆"});for(let e=1;e<=5;e++)o.push({id:`battlefield-1-${e}`,position:"战场"});for(let e=1;e<=2;e++)o.push({id:`battlefield-2-${e}`,position:"战场"});for(let e=1;e<=5;e++)o.push({id:`hand-1-${e}`,position:"手牌"});for(let e=1;e<=5;e++)o.push({id:`hand-2-${e}`,position:"手牌"})})();const r=e=>{const n=o.find(t=>t.id===e);b.value=e,n?.position==="酒馆"?(y.value=!0,i.value=!1):n?.position==="战场"?(y.value=!1,i.value=!0):(y.value=!1,i.value=!1),console.log(`[父组件] 开始拖拽卡片: ${e}, 当前位置: ${n?.position}, 手牌高亮: ${y.value}, 酒馆高亮: ${i.value}`)},g=(e,n)=>{console.log(`[父组件] 拖拽结束: 卡片 ${e}, 目标区域: ${n||"非手牌区域"}`),y.value=!1,i.value=!1,b.value=null},p=(e,n,t)=>{console.log(`[父组件] 卡片移动事件: 卡片 ${e} 从 ${n} 移动到 ${t}`);const f=o.find(x=>x.id===e);if(f){const x=f.position;f.position=t,console.log(`[父组件] 卡片位置更新: 卡片 ${e} 位置从 ${x} 变为 ${f.position}`),console.log("[父组件] 当前所有卡片位置:",JSON.parse(JSON.stringify(o)))}},d=e=>{console.log(`[父组件] 卡片移除事件: 卡片 ${e} 被移除`);const n=o.findIndex(t=>t.id===e);if(n>-1){const t=o.splice(n,1)[0];t&&console.log(`[父组件] 卡片 ${t.id} 已从 ${t.position} 区域移除`),console.log(`[父组件] 当前卡片数量: ${o.length}`)}};return w(()=>JSON.parse(JSON.stringify(o)),(e,n)=>{console.log("[父组件] 卡片位置映射变化: 旧位置:",n,"新位置:",e)},{deep:!0}),(e,n)=>(a(),s("div",P,[c("div",q,[c("div",{class:S(["game-section tavern-section",{"drop-allowed":i.value}])},[c("div",F,[(a(!0),s(u,null,v(o.filter(t=>t.position==="酒馆"&&t.id.startsWith("tavern-1-")),t=>(a(),$(_,{key:t.id,"card-id":t.id,"position-type":t.position,onDragStart:r,onDragEnd:g,onCardMove:p,onCardRemove:d},null,8,["card-id","position-type"]))),128)),(a(!0),s(u,null,v(Math.max(0,5-o.filter(t=>t.position==="酒馆"&&t.id.startsWith("tavern-1-")).length),t=>(a(),s("div",{key:"empty-tavern-1-"+t,class:"card-slot empty"}))),128))]),c("div",L,[(a(!0),s(u,null,v(o.filter(t=>t.position==="酒馆"&&t.id.startsWith("tavern-2-")),t=>(a(),$(_,{key:t.id,"card-id":t.id,"position-type":t.position,onDragStart:r,onDragEnd:g,onCardMove:p,onCardRemove:d},null,8,["card-id","position-type"]))),128)),(a(!0),s(u,null,v(Math.max(0,2-o.filter(t=>t.position==="酒馆"&&t.id.startsWith("tavern-2-")).length),t=>(a(),s("div",{key:"empty-tavern-2-"+t,class:"card-slot empty"}))),128)),n[0]||(n[0]=z('<div class="info-panel tavern-info" data-v-ba27b3ce><div class="stats-row" data-v-ba27b3ce><div data-v-ba27b3ce>酒馆等级：1级</div><button data-v-ba27b3ce>升级(1)</button></div><div class="buttons-row" data-v-ba27b3ce><div data-v-ba27b3ce>第x回合</div><button data-v-ba27b3ce>刷新(1)</button><button data-v-ba27b3ce>冻结(0)</button></div><div class="stats-row" data-v-ba27b3ce><div data-v-ba27b3ce>生命值：30 护甲：7</div><button data-v-ba27b3ce>技能</button></div><div class="buttons-row" data-v-ba27b3ce><div data-v-ba27b3ce>铸币：10/10</div><button data-v-ba27b3ce>设置</button><button data-v-ba27b3ce>调试</button></div></div>',1))])],2),c("div",V,[c("div",X,[(a(!0),s(u,null,v(o.filter(t=>t.position==="战场"&&t.id.startsWith("battlefield-1-")),t=>(a(),$(_,{key:t.id,"card-id":t.id,"position-type":t.position,onDragStart:r,onDragEnd:g,onCardMove:p,onCardRemove:d},null,8,["card-id","position-type"]))),128)),(a(!0),s(u,null,v(Math.max(0,5-o.filter(t=>t.position==="战场"&&t.id.startsWith("battlefield-1-")).length),t=>(a(),s("div",{key:"empty-battlefield-1-"+t,class:"card-slot empty"}))),128))]),c("div",Y,[(a(!0),s(u,null,v(o.filter(t=>t.position==="战场"&&t.id.startsWith("battlefield-2-")),t=>(a(),$(_,{key:t.id,"card-id":t.id,"position-type":t.position,onDragStart:r,onDragEnd:g,onCardMove:p,onCardRemove:d},null,8,["card-id","position-type"]))),128)),(a(!0),s(u,null,v(Math.max(0,2-o.filter(t=>t.position==="战场"&&t.id.startsWith("battlefield-2-")).length),t=>(a(),s("div",{key:"empty-battlefield-2-"+t,class:"card-slot empty"}))),128)),n[1]||(n[1]=c("div",{class:"info-panel player-info"},[c("div",null,"选中的卡片信息")],-1))])]),c("div",{class:S(["game-section hand-section",{"drop-allowed":y.value}])},[c("div",j,[(a(!0),s(u,null,v(o.filter(t=>t.position==="手牌"&&t.id.startsWith("hand-1-")),t=>(a(),$(_,{key:t.id,"card-id":t.id,"position-type":t.position,onDragStart:r,onDragEnd:g,onCardMove:p,onCardRemove:d},null,8,["card-id","position-type"]))),128)),(a(!0),s(u,null,v(Math.max(0,5-o.filter(t=>t.position==="手牌"&&t.id.startsWith("hand-1-")).length),t=>(a(),s("div",{key:"empty-hand-1-"+t,class:"card-slot empty"}))),128))]),c("div",H,[(a(!0),s(u,null,v(o.filter(t=>t.position==="手牌"&&t.id.startsWith("hand-2-")),t=>(a(),$(_,{key:t.id,"card-id":t.id,"position-type":t.position,onDragStart:r,onDragEnd:g,onCardMove:p,onCardRemove:d},null,8,["card-id","position-type"]))),128)),(a(!0),s(u,null,v(Math.max(0,5-o.filter(t=>t.position==="手牌"&&t.id.startsWith("hand-2-")).length),t=>(a(),s("div",{key:"empty-hand-2-"+t,class:"card-slot empty"}))),128))])],2)])]))}}),Q=W(K,[["__scopeId","data-v-ba27b3ce"]]);export{Q as default};
