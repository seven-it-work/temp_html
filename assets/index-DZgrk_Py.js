import{i as K}from"./interact.min-DJFmeFUZ.js";import{d as Y,i as R,D as N,j as U,k as W,c as _,v as G,s as F,l as J,t as O,o as $,_ as j,K as V,a as h,F as q,r as T,L as Q,f as B}from"./index-CDSb7IXy.js";const Z=["data-card-id","data-x","data-y","data-position-type","data-is-empty"],ee={key:0},te=Y({__name:"CardSlot",props:{positionType:{},cardId:{},data:{}},emits:["drag-start","drag-end","card-move","card-remove","card-swap"],setup(L,{emit:I}){const t=L,S=I,d=R({x:0,y:0}),n=R({x:0,y:0}),c=R(t.positionType),P=R(null);let E=null;return N(()=>t.positionType,(f,i)=>{f!==i&&(d.value={x:0,y:0})}),N(()=>t.data,(f,i)=>{console.log(`[数据变化] 卡片 ${t.cardId} 数据变化: ${i?i.id:"null"} -> ${f?f.id:"null"}`),E&&E.draggable({cursorChecker(){return f?"grabbing":"default"}})}),U(()=>{const f=P.value;f&&(E=K(f).draggable({inertia:!0,autoScroll:!1,cursorChecker(){return t.data?"grabbing":"default"},listeners:{start(i){if(!t.data)return i.stopPropagation(),!1;const y=i.target;n.value={...d.value},c.value=t.positionType,console.log(`[拖拽开始] 卡片: ${t.cardId}, 初始位置类型: ${c.value}, 初始坐标: (${n.value.x}, ${n.value.y})`),S("drag-start",t.cardId),y.style.zIndex="2000",y.style.opacity="0.8",y.style.transition="none",t.positionType==="手牌"?(console.log(`[高亮处理] 手牌卡片 ${t.cardId} 开始拖拽，高亮战场空格子`),document.querySelectorAll('.battlefield-section .card-slot[data-is-empty="true"]').forEach(o=>{o.classList.add("drop-allowed")})):t.positionType==="战场"&&(console.log(`[高亮处理] 战场卡片 ${t.cardId} 开始拖拽，高亮酒馆区域和所有战场卡片槽`),document.querySelectorAll(".tavern-section").forEach(l=>{l.classList.add("drop-allowed")}),document.querySelectorAll(".battlefield-section .card-slot").forEach(l=>{l.classList.add("swap-allowed")}))},move(i){if(!t.data)return i.stopPropagation(),!1;d.value.x+=i.dx,d.value.y+=i.dy,console.log(`[拖拽移动] 卡片: ${t.cardId}, 移动距离: (${i.dx}, ${i.dy}), 新坐标: (${d.value.x}, ${d.value.y})`)},end(i){if(!t.data)return i.stopPropagation(),!1;const y=i.target,u=i.clientX,o=i.clientY;console.log(`[拖拽结束] 卡片: ${t.cardId}, 释放屏幕坐标: (${u}, ${o})`);const l=document.querySelectorAll(".game-section.hand-section");let e=!1;for(const m of l){const s=m.getBoundingClientRect();if(console.log(`[区域检查] 手牌区域坐标: 左=${s.left}, 右=${s.right}, 上=${s.top}, 下=${s.bottom}`),u>=s.left&&u<=s.right&&o>=s.top&&o<=s.bottom){e=!0,console.log(`[区域检查] 卡片 ${t.cardId} 释放到手牌区域内`);break}}const a=document.querySelectorAll(".game-section.tavern-section");let r=!1;for(const m of a){const s=m.getBoundingClientRect();if(console.log(`[区域检查] 酒馆区域坐标: 左=${s.left}, 右=${s.right}, 上=${s.top}, 下=${s.bottom}`),u>=s.left&&u<=s.right&&o>=s.top&&o<=s.bottom){r=!0,console.log(`[区域检查] 卡片 ${t.cardId} 释放到酒馆区域内`);break}}const p=document.querySelectorAll(".game-section.battlefield-section");let k=!1;for(const m of p){const s=m.getBoundingClientRect();if(console.log(`[区域检查] 战场区域坐标: 左=${s.left}, 右=${s.right}, 上=${s.top}, 下=${s.bottom}`),u>=s.left&&u<=s.right&&o>=s.top&&o<=s.bottom){k=!0,console.log(`[区域检查] 卡片 ${t.cardId} 释放到战场区域内`);break}}let v=!1,g=-1,b=!1,z=!1;if(k){const m=document.querySelectorAll(".battlefield-section .card-row:nth-child(1) .card-slot"),s=document.querySelectorAll(".battlefield-section .card-row:nth-child(2) .card-slot"),H=[...m,...s];console.log(`[区域检查] 战场区域内卡片槽数量: ${H.length}, 第一行: ${m.length}, 第二行: ${s.length}`),console.log(`[区域检查] 释放坐标: (${u}, ${o})`);let A=0,X=!1;for(const x of H){if(x.getAttribute("data-card-id")===t.cardId){console.log(`[区域检查] 跳过当前拖拽的卡片槽 ${A}`),A++;continue}const C=x.getBoundingClientRect();console.log(`[区域检查] 卡片槽 ${A} 坐标: 左=${C.left}, 右=${C.right}, 上=${C.top}, 下=${C.bottom}`);const D=u>=C.left&&u<=C.right&&o>=C.top&&o<=C.bottom;if(console.log(`[区域检查] 卡片槽 ${A} 是否包含释放点: ${D}`),D){b=!0,g=A,v=x.getAttribute("data-is-empty")==="true",z=!v,console.log(`[区域检查] 卡片 ${t.cardId} 释放到战场卡片槽上，索引: ${g}, 是否为空: ${v}`),X=!0;break}A++}if(!X){console.log(`[区域检查] 卡片 ${t.cardId} 释放到战场区域内，但未找到匹配的卡片槽`);const x=document.querySelector(".battlefield-section .card-row:nth-child(2)");if(x){const w=x.getBoundingClientRect();if(console.log(`[区域检查] 第二行区域坐标: 左=${w.left}, 右=${w.right}, 上=${w.top}, 下=${w.bottom}`),o>=w.top&&o<=w.bottom){const C=w.width/3,D=Math.floor((u-w.left)/C);D>=0&&D<2&&(g=5+D,b=!0,v=!0,z=!1,console.log(`[区域检查] 卡片 ${t.cardId} 释放到战场第二行卡片槽，计算索引: ${g}`))}}}}if(S("drag-end",t.cardId,e?"hand":r?"tavern":k?"battlefield":null),r&&c.value==="战场"){console.log(`[位置更新] 战场卡片 ${t.cardId} 拖拽到酒馆区域，卡片消失`),S("card-remove",t.cardId);return}e&&c.value==="酒馆"?(console.log(`[位置更新] 卡片 ${t.cardId} 从 ${c.value} 移动到手牌区域`),S("card-move",t.cardId,c.value,"手牌"),d.value={x:0,y:0},console.log(`[位置更新] 卡片 ${t.cardId} 位置重置为 (0, 0)`)):v&&c.value==="手牌"?(console.log(`[位置更新] 卡片 ${t.cardId} 从 ${c.value} 移动到战场区域，目标空格子索引: ${g}`),S("card-move",t.cardId,c.value,"战场",g),d.value={x:0,y:0},console.log(`[位置更新] 卡片 ${t.cardId} 位置重置为 (0, 0)`)):b&&c.value==="战场"?(console.log(`[位置更新] 战场卡片 ${t.cardId} 拖拽到另一个战场卡片槽，索引: ${g}, 目标槽是否有卡片: ${z}`),S("card-swap",t.cardId,g),d.value={x:0,y:0},console.log(`[位置更新] 卡片 ${t.cardId} 位置重置为 (0, 0)`)):(console.log(`[位置更新] 卡片 ${t.cardId} 回到初始位置: (${n.value.x}, ${n.value.y})`),d.value={...n.value}),y.style.zIndex="",y.style.opacity="1",y.style.transition="transform 0.1s ease, opacity 0.2s ease",document.querySelectorAll(".card-slot").forEach(m=>{m.classList.remove("drop-allowed","swap-allowed")}),document.querySelectorAll(".tavern-section").forEach(m=>{m.classList.remove("drop-allowed")}),document.querySelectorAll(".hand-section").forEach(m=>{m.classList.remove("drop-allowed")})}}}))}),W(()=>{E&&E.unset()}),(f,i)=>($(),_("div",{ref_key:"cardRef",ref:P,class:F(["card-slot",[`position-${t.positionType}`,{empty:t.data===null||t.data===void 0}]]),"data-card-id":L.cardId,"data-x":d.value.x,"data-y":d.value.y,"data-position-type":t.positionType,"data-is-empty":t.data===null||t.data===void 0,style:G({transform:`translate(${d.value.x}px, ${d.value.y}px)`})},[L.data?($(),_("span",ee,O(L.data.id.slice(-10)),1)):J("",!0)],14,Z))}}),M=j(te,[["__scopeId","data-v-ecea216b"]]),oe={class:"vertical-hearthstone"},le={class:"game-container"},ae={class:"card-row"},ne={class:"card-row"},se={class:"game-section battlefield-section"},de={class:"card-row"},ie={class:"card-row"},re={class:"card-row"},ce={class:"card-row"},ue=Y({__name:"index",setup(L){const I=R(!1),t=R(!1),S=R(null),d=V([]),n=V([]),c=V([]),P=()=>{d.length=0,n.length=0,c.length=0;for(let o=1;o<=3;o++)d.push({id:`tavern-${o}`,position:"酒馆"});for(let o=1;o<=4;o++)d.push(null);for(let o=1;o<=7;o++)n.push(null);for(let o=1;o<=10;o++)c.push(null)},E=(o,l)=>{console.log(`[父组件] 卡片交换事件: 卡片 ${o} 交换到目标索引: ${l}`);const e=n.findIndex(p=>p&&p.id===o);if(e===-1){console.error(`[父组件] 未找到卡片: ${o} 在战场区域`);return}if(console.log(`[父组件] 源卡片索引: ${e}, 目标索引: ${l}`),l<0||l>=n.length){console.error(`[父组件] 无效的目标索引: ${l}`);return}const a=n[e]||null,r=n[l]||null;n[e]=r,n[l]=a,console.log(`[父组件] 卡片交换成功: ${o} 从索引 ${e} 移动到 ${l}`),n[e]&&(n[e].position="战场"),n[l]&&(n[l].position="战场")};P();const f=o=>{let l=null;l=[...d,...n,...c].find(r=>r&&r.id===o)||null,S.value=o,l?.position==="酒馆"?(I.value=!0,t.value=!1):l?.position==="战场"?(I.value=!1,t.value=!0):(I.value=!1,t.value=!1),console.log(`[父组件] 开始拖拽卡片: ${o}, 当前位置: ${l?.position}, 手牌高亮: ${I.value}, 酒馆高亮: ${t.value}`)},i=(o,l)=>{console.log(`[父组件] 拖拽结束: 卡片 ${o}, 目标区域: ${l||"非手牌区域"}`),I.value=!1,t.value=!1,S.value=null},y=(o,l,e,a)=>{console.log(`[父组件] 卡片移动事件: 卡片 ${o} 从 ${l} 移动到 ${e}${a!==void 0?`, 目标空格子索引: ${a}`:""}`);let r=null,p=[],k=-1;if(l==="酒馆"?p=d:l==="战场"?p=n:l==="手牌"&&(p=c),k=p.findIndex(v=>v&&v.id===o),k>-1&&(r=p[k]||null,r)){let v=[];e==="酒馆"?v=d:e==="战场"?v=n:e==="手牌"&&(v=c);let g=-1;l==="手牌"&&e==="战场"&&a!==void 0&&a>=0&&a<v.length&&v[a]===null&&(g=a,console.log(`[父组件] 手牌到战场拖拽，直接使用目标索引: ${a}`)),g===-1&&(g=v.findIndex(b=>b===null),console.log(`[父组件] 使用第一个空位索引: ${g}`)),g>-1?(r.position=e,p[k]=null,v[g]=r,console.log(`[父组件] 卡片位置更新: 卡片 ${o} 位置从 ${l} 变为 ${e}`),console.log(`[父组件] 当前卡片分布: 酒馆 ${d.filter(b=>b).length}/${d.length}张, 战场 ${n.filter(b=>b).length}/${n.length}张, 手牌 ${c.filter(b=>b).length}/${c.length}张`)):console.log(`[父组件] 目标区域 ${e} 没有空位，无法移动卡片`)}},u=o=>{console.log(`[父组件] 卡片移除事件: 卡片 ${o} 被移除`);const l=[d,n,c];for(const e of l){const a=e.findIndex(r=>r&&r.id===o);if(a>-1){const r=e.splice(a,1)[0];r&&(e.splice(a,0,null),console.log(`[父组件] 卡片 ${r.id} 已从 ${r.position} 区域移除`));break}}console.log(`[父组件] 当前卡片分布: 酒馆 ${d.length}, 战场 ${n.length}, 手牌 ${c.length}`)};return N([d,n,c],([o,l,e])=>{console.log("[父组件] 卡片数据变化:",{tavern:o,battlefield:l,hand:e})},{deep:!0}),(o,l)=>($(),_("div",oe,[h("div",le,[h("div",{class:F(["game-section tavern-section",{"drop-allowed":t.value}])},[h("div",ae,[($(!0),_(q,null,T(d.slice(0,5),(e,a)=>($(),B(M,{key:e?e.id:"empty-tavern-1-"+a,"card-id":e?e.id:"empty-tavern-1-"+a,"position-type":"酒馆",data:e,onDragStart:f,onDragEnd:i,onCardMove:y,onCardRemove:u},null,8,["card-id","data"]))),128))]),h("div",ne,[($(!0),_(q,null,T(d.slice(5,7),(e,a)=>($(),B(M,{key:e?e.id:"empty-tavern-2-"+a,"card-id":e?e.id:"empty-tavern-2-"+a,"position-type":"酒馆",data:e,onDragStart:f,onDragEnd:i,onCardMove:y,onCardRemove:u},null,8,["card-id","data"]))),128)),l[2]||(l[2]=Q('<div class="info-panel tavern-info" data-v-ef680e51><div class="stats-row" data-v-ef680e51><div data-v-ef680e51>酒馆等级：1级</div><button data-v-ef680e51>升级(1)</button></div><div class="buttons-row" data-v-ef680e51><div data-v-ef680e51>第x回合</div><button data-v-ef680e51>刷新(1)</button><button data-v-ef680e51>冻结(0)</button></div><div class="stats-row" data-v-ef680e51><div data-v-ef680e51>生命值：30 护甲：7</div><button data-v-ef680e51>技能</button></div><div class="buttons-row" data-v-ef680e51><div data-v-ef680e51>铸币：10/10</div><button data-v-ef680e51>设置</button><button data-v-ef680e51>调试</button></div></div>',1))])],2),h("div",se,[h("div",de,[($(!0),_(q,null,T(n.slice(0,5),(e,a)=>($(),B(M,{key:e?e.id:"empty-battlefield-1-"+a,"card-id":e?e.id:"empty-battlefield-1-"+a,"position-type":"战场",data:e,onDragStart:f,onDragEnd:i,onCardMove:y,onCardRemove:u,onCardSwap:l[0]||(l[0]=(r,p)=>E(r,p))},null,8,["card-id","data"]))),128))]),h("div",ie,[($(!0),_(q,null,T(n.slice(5,7),(e,a)=>($(),B(M,{key:e?e.id:"empty-battlefield-2-"+a,"card-id":e?e.id:"empty-battlefield-2-"+a,"position-type":"战场",data:e,onDragStart:f,onDragEnd:i,onCardMove:y,onCardRemove:u,onCardSwap:l[1]||(l[1]=(r,p)=>E(r,p))},null,8,["card-id","data"]))),128)),l[3]||(l[3]=h("div",{class:"info-panel player-info"},[h("div",null,"选中的卡片信息")],-1))])]),h("div",{class:F(["game-section hand-section",{"drop-allowed":I.value}])},[h("div",re,[($(!0),_(q,null,T(c.slice(0,5),(e,a)=>($(),B(M,{key:e?e.id:"empty-hand-1-"+a,"card-id":e?e.id:"empty-hand-1-"+a,"position-type":"手牌",data:e,onDragStart:f,onDragEnd:i,onCardMove:y,onCardRemove:u},null,8,["card-id","data"]))),128))]),h("div",ce,[($(!0),_(q,null,T(c.slice(5,10),(e,a)=>($(),B(M,{key:e?e.id:"empty-hand-2-"+a,"card-id":e?e.id:"empty-hand-2-"+a,"position-type":"手牌",data:e,onDragStart:f,onDragEnd:i,onCardMove:y,onCardRemove:u},null,8,["card-id","data"]))),128))])],2)])]))}}),ye=j(ue,[["__scopeId","data-v-ef680e51"]]);export{ye as default};
