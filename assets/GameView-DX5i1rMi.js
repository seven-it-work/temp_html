import{d as A,i as R,j as G,k as J,c as v,m as O,a as l,l as x,t as h,n as q,o as c,_ as N,p as S,q as B,F as w,r as z,h as H,s as W,b as u,f as L,g as K}from"./index-CU42gLE2.js";import{u as F,D as Q,h as I,P as X,T as Y,A as Z,m as U,a as ee}from"./MinionClassMap-DjRccpwo.js";import{i as V}from"./interact.min-DasjzKHT.js";const te={class:"corner-circle top-left"},se={class:"circle-text big"},ne={key:0,class:"corner-circle top-right"},ae={class:"circle-text big"},re={class:"card-name"},oe={class:"card-content"},ie={key:1,class:"card-bottom"},le={class:"corner-circle bottom-left"},ce={class:"circle-text attack"},de={class:"bottom-texts"},ue={key:0,class:"text-item"},ge={class:"corner-circle bottom-right"},pe={class:"circle-text health"},ve=A({__name:"HearthstoneCard",props:{card:{},isSelected:{type:Boolean},isHighlighted:{type:Boolean},isDragging:{type:Boolean},index:{},source:{}},emits:["click","card-selected"],setup($,{emit:e}){const g=F(),a=$,M=e,_=()=>{a.card&&(a.card.cardType==="minion"?g.selectMinion(a.card,a.index||0,a.source||"hand"):a.card.cardType==="spell"&&g.selectSpell(a.card,a.index||0),M("card-selected",a.card,a.index))},y=f=>{_(),M("click",f)},i=R(!1),p=R(!1),o=R(null),n=f=>{let C=null,D="minion";if(a.card&&(C=a.card,D=a.card.cardType),!C){f.preventDefault();return}if(i.value=!0,f.dataTransfer&&f.target){const d=document.createElement("div");d.className="hearthstone-card-drag-image",d.textContent=a.card?.name||"Card",d.style.position="absolute",d.style.top="-1000px",d.style.left="-1000px",d.style.width="150px",d.style.height="200px",d.style.border="2px solid #000",d.style.backgroundColor="#e0e0e0",d.style.borderRadius="8px",d.style.display="flex",d.style.alignItems="center",d.style.justifyContent="center",d.style.fontSize="16px",d.style.fontWeight="bold",document.body.appendChild(d),f.dataTransfer.setDragImage(d,75,100),setTimeout(()=>{document.body.removeChild(d)},0)}if(D==="spell")g.startSpellDrag(f,C,a.index||0),f.preventDefault();else{const d={source:a.source||"hand",index:a.index||0,cardId:C.id||C.instanceId,strId:C.strId,cardType:D};console.log(`[拖拽开始] 从${d.source}拖拽第${d.index}个位置的${d.cardType}`),f.dataTransfer?.setData("text/plain",JSON.stringify(d))}},t=()=>{i.value=!1},s=()=>{p.value=!0},r=()=>{p.value=!1},b=()=>a.card?.cardType==="minion"?a.card.tier:2,T=()=>a.card?a.card.cost:1,m=()=>a.card?a.card.nameCN:"名称",k=()=>a.card?.cardType==="minion"?a.card.attack:999999,E=()=>a.card?.cardType==="minion"?a.card.health:999999,j=()=>a.card?.cardType==="minion"?a.card.minionTypesCN?.join("/"):null;return G(()=>{o.value&&V(o.value).draggable({inertia:!0,modifiers:[V.modifiers.restrictRect({restriction:"parent",endOnly:!0})],autoScroll:!0,listeners:{start(f){n(f)},move(f){const C=f.target,D=(parseFloat(C.getAttribute("data-x"))||0)+f.dx,d=(parseFloat(C.getAttribute("data-y"))||0)+f.dy;C.style.transform=`translate(${D}px, ${d}px)`,C.setAttribute("data-x",D),C.setAttribute("data-y",d)},end(f){t()}}})}),J(()=>{o.value&&V(o.value).unset()}),(f,C)=>a.card?(c(),v("div",O({key:0,ref_key:"cardElement",ref:o,class:["hearthstone-card",{selected:$.isSelected,highlighted:$.isHighlighted,dragging:i.value}],onClick:y,onMouseenter:s,onMouseleave:r},f.$attrs),[l("div",te,[l("span",se,h(b()),1)]),a.source==="tavern"?(c(),v("div",ne,[l("span",ae,h(T()),1)])):x("",!0),l("div",re,h(m()),1),l("div",oe,[q(f.$slots,"default",{},void 0)]),a.card?.cardType==="minion"?(c(),v("div",ie,[l("div",le,[l("span",ce,h(k()),1)]),l("div",de,[j()?(c(),v("span",ue,h(j()),1)):x("",!0)]),l("div",ge,[l("span",pe,h(E()),1)])])):x("",!0)],16)):(c(),v("div",O({key:1,class:["hearthstone-card hearthstone-card-empty",f.$attrs.class]},f.$attrs)," 空 ",16))}}),P=N(ve,[["__scopeId","data-v-4eb2665c"]]),he={class:"row battlefield-container"},fe=A({__name:"HearthstoneBattlefield",setup($){const e=F(),g=S(()=>e.player),a=R(null),M=(n,t,s,r)=>{a.value=s,n.dataTransfer&&r&&n.dataTransfer.setData("text/plain",JSON.stringify({source:t,index:s,card:r}))},_=S(()=>g.value?.minions||[]),y=(n,t)=>{n.preventDefault()},i=(n,t)=>{n.preventDefault();const s=n.dataTransfer?.getData("text/plain");if(s)try{const r=JSON.parse(s);if(r.source==="hand"){let b=0;const T=_.value;if(typeof t=="number"){if(!T?.[t])b=t;else for(let m=0;m<7;m++)if(!T?.[m]){b=m;break}}else for(let m=0;m<7;m++)if(!T?.[m]){b=m;break}T.some(m=>m===null)&&e.placeMinionFromHand(r.index,b)}else if(r.source==="battlefield"&&typeof t=="number"){const b=t;a.value!==null&&a.value!==b&&(e.reorderMinions(a.value,b),e.selectedMinionIndex===a.value&&(e.selectedMinionIndex=b)),a.value=null}}catch{}},p=(n,t)=>{if(n)if(e.spellUsageState==="selecting_target"&&e.selectedSpell){const s=e.highlightedTargets.find(r=>r.source==="battlefield"&&r.index===t&&r.target===n);s&&e.selectSpellTarget(s)}else e.selectMinion(n,t,"battlefield")},o=(n,t,s)=>!e.selectedSpell||e.spellUsageState!=="selecting_target"?!1:e.highlightedTargets.some(r=>r.source===t&&r.index===s&&r.target===n);return(n,t)=>(c(),v("div",he,[l("div",{class:"player-minions",onDragover:t[0]||(t[0]=B(()=>{},["prevent"]))},[(c(),v(w,null,z(7,s=>H(P,{key:s,card:_.value?.[s-1]||null,index:s-1,source:"battlefield","is-selected":!!(_.value?.[s-1]&&u(e).selectedMinion?.instanceId===_.value[s-1]?.instanceId),"is-highlighted":!!(_.value?.[s-1]&&o(_.value[s-1],"battlefield",s-1)),class:W({empty:!_.value?.[s-1]}),onClick:r=>p(_.value?.[s-1]||void 0,s-1),draggable:!!_.value?.[s-1],onDragstart:r=>M(r,"battlefield",s-1,_.value?.[s-1]||void 0),onDragover:B(r=>y(r),["prevent"]),onDrop:B(r=>i(r,s-1),["prevent"])},null,8,["card","index","is-selected","is-highlighted","class","onClick","draggable","onDragstart","onDragover","onDrop"])),64))],32)]))}}),_e=N(fe,[["__scopeId","data-v-effb72a3"]]),ye={class:"row"},me={class:"row"},be=A({__name:"HearthstoneHand",setup($){const e=F(),g=S(()=>e.player),a=S(()=>g.value?.cards?g.value.cards.slice(0,5):[]),M=S(()=>g.value?.cards?g.value.cards.slice(5,10):[]),_=S(()=>{const n=a.value.length;return Math.max(0,5-n)}),y=S(()=>{const n=M.value.length;return Math.max(0,5-n)}),i=(o,n)=>{console.log(`选择了手牌中的第${n}个位置的卡片:`,o)},p=(o,n)=>{o.preventDefault();const t=o.dataTransfer?.getData("text/plain");if(t)try{const s=JSON.parse(t);if(console.log(`[拖拽放置] 从${s.source}拖拽第${s.index}个位置的卡牌到手牌`),s.source==="tavern"&&n==="hand"){const r=s.index;console.log(`[购买随从] 尝试购买酒馆第${r}个位置的随从`);const b=e.buyMinion(r);console.log(`[购买结果] ${b?"购买成功":"购买失败，可能是金币不足或手牌已满"}`)}}catch{}};return(o,n)=>(c(),v("div",{class:"right-subsection",onDragover:n[0]||(n[0]=B(()=>{},["prevent"])),onDrop:n[1]||(n[1]=t=>p(t,"hand"))},[l("div",ye,[(c(!0),v(w,null,z(a.value,(t,s)=>(c(),L(P,{key:t?.id||`card-${s}`,card:t,index:s,source:"hand",onClick:r=>i(t,s)},null,8,["card","index","onClick"]))),128)),(c(!0),v(w,null,z(_.value,t=>(c(),L(P,{key:`empty-top-${t}`,card:null,index:t+(g.value?.cards.length||0),source:"hand"},null,8,["index"]))),128))]),l("div",me,[(c(!0),v(w,null,z(M.value,(t,s)=>(c(),L(P,{key:t?.id||`card-${s+5}`,card:t,index:s+5,source:"hand",onClick:r=>i(t,s+5)},null,8,["card","index","onClick"]))),128)),(c(!0),v(w,null,z(y.value,t=>(c(),L(P,{key:`empty-bottom-${t}`,card:null,index:t+5+Math.min(g.value?.cards.length||0,5),source:"hand"},null,8,["index"]))),128))])],32))}}),Me=N(be,[["__scopeId","data-v-9033ad9b"]]),Ce=A({__name:"HearthstoneTavern",setup($){const e=F();console.log(e);const g=S(()=>e.tavern),a=(i,p)=>{if(e.spellUsageState==="selecting_target"&&e.selectedSpell){const o=e.highlightedTargets.find(n=>n.source==="tavern"&&n.index===p&&n.target===i);o&&e.selectSpellTarget(o)}},M=(i,p,o)=>!e.selectedSpell||e.spellUsageState!=="selecting_target"?!1:e.highlightedTargets.some(n=>n.source===p&&n.index===o&&n.target===i),_=i=>{i.preventDefault()},y=(i,p)=>{i.preventDefault();const o=i.dataTransfer?.getData("text/plain");if(o)try{const n=JSON.parse(o);n.source==="battlefield"&&p==="tavern"&&e.sellMinion("minion",n.index)}catch{}};return(i,p)=>(c(),v("div",{class:"row",onDragover:B(_,["prevent"]),onDrop:p[0]||(p[0]=o=>y(o,"tavern"))},[(c(),v(w,null,z(7,o=>H(P,{key:`tavern-${o}`,card:g.value?.availableMinions?.[o-1],index:o-1,"is-selected":u(e).selectedMinion?.instanceId===g.value?.availableMinions?.[o-1]?.instanceId,"is-highlighted":M(g.value?.availableMinions?.[o-1],"tavern",o-1),onClick:n=>a(g.value?.availableMinions?.[o-1],o-1),source:"tavern"},null,8,["card","index","is-selected","is-highlighted","onClick"])),64))],32))}}),ke=N(Ce,[["__scopeId","data-v-c855f11f"]]),Se={class:"large-cell"},Te={class:"tavern-info"},xe={class:"tavern-level big-size"},$e=["disabled"],we=["disabled"],He={class:"player-stats"},De={class:"health-armor big-size"},ze={class:"coins big-size"},Pe={class:"big-size"},Ae={key:0,class:"card-info"},Ne={class:"card-left"},Fe={class:"card-name big-size"},Re={class:"card-name big-size"},Be={class:"card-level big-size"},Le={class:"card-cost big-size"},Ee={key:0,class:"card-attack big-size"},Ie={key:1,class:"card-health big-size"},Ve={key:2,class:"card-type big-size"},je={class:"card-right"},Oe=["innerHTML"],Ue=["innerHTML"],Ge={class:"action-buttons"},Je={class:"cost"},qe=A({__name:"ActionArea",setup($){const e=F(),g=R(!1),a=()=>{g.value=!0},M=()=>{g.value=!1},_=S(()=>{if(!e.player)return!1;const k=[0,5,7,8,10,12,12][e.player.tavernLevel]||0;return e.player.gold>=k&&e.player.tavernLevel<6}),y=S(()=>e.player&&[0,5,7,8,10,12,12][e.player.tavernLevel]||0),i=()=>{e.upgradeTavern()},p=()=>{e.refreshTavern()},o=()=>{e.tavern?.isFrozen?e.unfreezeTavern():e.freezeTavern()},n=S(()=>e.selectedMinion||e.selectedSpell),t=S(()=>e.selectedMinion?e.selectedMinion.cardType==="minion"?"随从":"其他":e.selectedSpell?e.selectedSpell.type==="shaping"?"法术/塑造法术":"法术":"随从/塑造法术"),s=()=>{e.endTurn()},r=()=>{e.selectedMinion&&(e.buyMinion(e.selectedMinionIndex||0),e.cancelSelectMinion())},b=()=>{e.selectedMinion&&e.selectedMinionIndex!==null&&(e.sellMinion("minion",e.selectedMinionIndex),e.cancelSelectMinion())},T=()=>{e.selectedMinion&&e.selectedMinionIndex!==null&&(e.placeMinionFromHand(e.selectedMinionIndex,0),e.cancelSelectMinion())};return(m,k)=>(c(),v(w,null,[l("div",Se,[l("div",Te,[l("div",xe,"酒馆等级："+h(u(e).player?.tavernLevel||1),1),l("button",{class:"action-button big-size",disabled:!_.value,onClick:i}," 升级("+h(y.value)+") ",9,$e),l("button",{class:"action-button big-size",disabled:!(u(e).player&&u(e).player.gold>=1),onClick:p}," 刷新(1) ",8,we),l("button",{class:"action-button big-size",onClick:o},h(u(e).tavern?.isFrozen?"解冻(1)":"冻结(1)"),1)]),l("div",He,[l("div",De," 生命值："+h(u(e).player?.hero?.health||30)+" 护甲："+h(u(e).player?.hero?.armor||0),1),l("div",ze," 铸币："+h(u(e).player?.gold||0)+"/"+h(u(e).player?.maxGold||10),1),l("div",Pe,"第"+h(u(e).currentTurn||1)+"回合",1)]),n.value?(c(),v("div",Ae,[l("div",Ne,[l("div",Fe,"名称："+h(n.value?.name||""),1),l("div",Re,"类型："+h(t.value),1),l("div",Be,"等级："+h(n.value?.tier||1),1),l("div",Le,"花费："+h(n.value?.cost||1),1),u(e).selectedMinion?(c(),v("div",Ee," 攻击："+h(u(e).selectedMinion.attack||0),1)):x("",!0),u(e).selectedMinion?(c(),v("div",Ie," 生命值："+h(u(e).selectedMinion.health||0),1)):x("",!0),u(e).selectedMinion?(c(),v("div",Ve," 类型："+h(u(e).selectedMinion.minionTypesCN?.join(" | ")||""),1)):x("",!0)]),l("div",je,[l("div",{class:"card-description big-size",innerHTML:n.value?.text||""},null,8,Oe),u(e).selectedSpell?(c(),v("div",{key:0,class:"card-effects big-size",innerHTML:"法术效果："+(u(e).selectedSpell.text||"无描述")},null,8,Ue)):x("",!0)])])):x("",!0),l("div",Ge,[u(e).selectedMinionSource==="tavern"?(c(),v("button",{key:0,class:"action-button big-size",onClick:r},[k[1]||(k[1]=K(" 购买 ",-1)),l("span",Je,"("+h(u(e).selectedMinion?.cost||0)+")",1)])):x("",!0),u(e).selectedMinionSource==="hand"?(c(),v("button",{key:1,class:"action-button big-size",onClick:T}," 放置随从 ")):x("",!0),u(e).selectedMinionSource==="battlefield"?(c(),v("button",{key:2,class:"action-button big-size",onClick:b}," 出售 ")):x("",!0),l("button",{class:"action-button big-size",onClick:s},"结束回合"),k[2]||(k[2]=l("button",{class:"action-button big-size"},"设置按钮",-1)),l("button",{class:"action-button big-size",onClick:a},"调试按钮")])]),H(Q,{"debug-drawer-visible":g.value,"onUpdate:debugDrawerVisible":k[0]||(k[0]=E=>g.value=E),"game-state":u(e).gameState,"current-turn":u(e).currentTurn,onClose:M},null,8,["debug-drawer-visible","game-state","current-turn"])],64))}}),We=N(qe,[["__scopeId","data-v-7f3777c8"]]),Ke={class:"main-frame",id:"game-main"},Qe={class:"top-section"},Xe={class:"bottom-section"},Ye=A({__name:"GameView",setup($){const e=F(),g=()=>{const p=[...I].sort(()=>.5-Math.random()).slice(0,3);e.setAvailableHeroes(p)},a=()=>{const y=Object.keys(U),i=t=>{let s=[];return t.forEach(r=>{s.push(r),r.tokens&&Array.isArray(r.tokens)&&(s=s.concat(i(r.tokens))),r.upgradeCard&&(s.push(r.upgradeCard),r.upgradeCard.tokens&&Array.isArray(r.upgradeCard.tokens)&&(s=s.concat(i(r.upgradeCard.tokens))))}),s},o=i(ee).filter(t=>t.cardType==="minion"&&y.includes(t.strId)).map(t=>{const s=U[t.strId];if(s)try{return new s(t.id,t.strId,t.cardType,t.name,t.nameCN,t.text,t.mechanics||[],t.referencedTags||[],t.img,t.art,t.tier,t.health,t.attack,t.minionTypes||[],t.minionTypesCN||[],t.upgradeCard)}catch(r){return console.error(`创建随从 ${t.strId} 实例时出错:`,r),null}return null}).filter(t=>t!==null);return{globalMinionPool:o,tavernMinionPool:o}},M=y=>{const{globalMinionPool:i,tavernMinionPool:p}=a(),o=y.heroPowerList?.[0]||{name:"未知技能",text:"无描述",manaCost:0},n={...y,heroPower:{name:o.name,description:o.text,type:"active",cost:o.manaCost,cooldown:0,currentCooldown:0,use:()=>{}}},t=new X("player-1",n,!0),s=new Y(1,p);s.refresh();const r=[];for(let b=0;b<7;b++){const T=I[b%I.length],m=T.heroPowerList?.[0]||{name:"未知技能",text:"无描述",manaCost:0},k={...T,heroPower:{name:m.name,description:m.text,type:"active",cost:m.manaCost,cooldown:0,currentCooldown:0,use:()=>{}}};r.push(new Z(`ai-${b+1}`,k))}e.initGame(t,s,r,i)},_=y=>{const i=e.availableHeroes.find(p=>p.id===y);i&&(e.selectHero(i),M(i),console.log("选择了英雄:",i.name))};return G(()=>{if(g(),e.availableHeroes.length>0){const y=Math.floor(Math.random()*e.availableHeroes.length),i=e.availableHeroes[y];i&&(_(i.id),console.log("页面加载时随机选择了英雄:",i.name||"未知英雄"))}}),(y,i)=>(c(),v("div",Ke,[l("div",Qe,[H(ke),H(_e)]),l("div",Xe,[H(We),H(Me)])]))}}),st=N(Ye,[["__scopeId","data-v-730fe6fe"]]);export{st as default};
