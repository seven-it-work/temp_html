import{i as z}from"./interact.min-CbgxsaLj.js";import{d as B,i as _,D as M,j as F,k as N,c as b,v as P,s as q,a as f,t as V,o as v,_ as L,K as T,F as x,r as I,L as X,f as E}from"./index-DmZpT51s.js";const Y=["data-x","data-y","data-position-type","data-is-empty"],j=B({__name:"CardSlot",props:{positionType:{},cardId:{},data:{}},emits:["drag-start","drag-end","card-move","card-remove"],setup(A,{emit:$}){const a=A,h=$,s=_({x:0,y:0}),r=_({x:0,y:0}),d=_(a.positionType),R=_(null);let m=null;return M(()=>a.positionType,(y,i)=>{y!==i&&(s.value={x:0,y:0})}),F(()=>{const y=R.value;y&&(m=z(y).draggable({inertia:!0,autoScroll:!1,cursorChecker(){return"grabbing"},listeners:{start(i){const u=i.target;r.value={...s.value},d.value=a.positionType,console.log(`[拖拽开始] 卡片: ${a.cardId}, 初始位置类型: ${d.value}, 初始坐标: (${r.value.x}, ${r.value.y})`),h("drag-start",a.cardId),u.style.zIndex="2000",u.style.opacity="0.8",u.style.transition="none",a.positionType==="手牌"?(console.log(`[高亮处理] 手牌卡片 ${a.cardId} 开始拖拽，高亮战场空格子`),document.querySelectorAll('.battlefield-section .card-slot[data-is-empty="true"]').forEach(o=>{o.classList.add("drop-allowed")})):a.positionType==="战场"&&(console.log(`[高亮处理] 战场卡片 ${a.cardId} 开始拖拽，高亮酒馆区域`),document.querySelectorAll(".tavern-section").forEach(o=>{o.classList.add("drop-allowed")}))},move(i){s.value.x+=i.dx,s.value.y+=i.dy,console.log(`[拖拽移动] 卡片: ${a.cardId}, 移动距离: (${i.dx}, ${i.dy}), 新坐标: (${s.value.x}, ${s.value.y})`)},end(i){const u=i.target,e=i.clientX,o=i.clientY;console.log(`[拖拽结束] 卡片: ${a.cardId}, 释放屏幕坐标: (${e}, ${o})`);const t=document.querySelectorAll(".game-section.hand-section");let l=!1;for(const p of t){const n=p.getBoundingClientRect();if(console.log(`[区域检查] 手牌区域坐标: 左=${n.left}, 右=${n.right}, 上=${n.top}, 下=${n.bottom}`),e>=n.left&&e<=n.right&&o>=n.top&&o<=n.bottom){l=!0,console.log(`[区域检查] 卡片 ${a.cardId} 释放到手牌区域内`);break}}const c=document.querySelectorAll(".game-section.tavern-section");let C=!1;for(const p of c){const n=p.getBoundingClientRect();if(console.log(`[区域检查] 酒馆区域坐标: 左=${n.left}, 右=${n.right}, 上=${n.top}, 下=${n.bottom}`),e>=n.left&&e<=n.right&&o>=n.top&&o<=n.bottom){C=!0,console.log(`[区域检查] 卡片 ${a.cardId} 释放到酒馆区域内`);break}}const g=document.querySelectorAll(".game-section.battlefield-section");let S=!1;for(const p of g){const n=p.getBoundingClientRect();if(console.log(`[区域检查] 战场区域坐标: 左=${n.left}, 右=${n.right}, 上=${n.top}, 下=${n.bottom}`),e>=n.left&&e<=n.right&&o>=n.top&&o<=n.bottom){S=!0,console.log(`[区域检查] 卡片 ${a.cardId} 释放到战场区域内`);break}}let w=!1;if(S){const p=document.querySelectorAll('.battlefield-section .card-slot[data-is-empty="true"]');for(const n of p){const k=n.getBoundingClientRect();if(e>=k.left&&e<=k.right&&o>=k.top&&o<=k.bottom){w=!0,console.log(`[区域检查] 卡片 ${a.cardId} 释放到战场空格子上`);break}}}if(h("drag-end",a.cardId,l?"hand":C?"tavern":S?"battlefield":null),C&&d.value==="战场"){console.log(`[位置更新] 战场卡片 ${a.cardId} 拖拽到酒馆区域，卡片消失`),h("card-remove",a.cardId);return}l&&d.value==="酒馆"?(console.log(`[位置更新] 卡片 ${a.cardId} 从 ${d.value} 移动到手牌区域`),h("card-move",a.cardId,d.value,"手牌"),s.value={x:0,y:0},console.log(`[位置更新] 卡片 ${a.cardId} 位置重置为 (0, 0)`)):w&&d.value==="手牌"?(console.log(`[位置更新] 卡片 ${a.cardId} 从 ${d.value} 移动到战场区域`),h("card-move",a.cardId,d.value,"战场"),s.value={x:0,y:0},console.log(`[位置更新] 卡片 ${a.cardId} 位置重置为 (0, 0)`)):(console.log(`[位置更新] 卡片 ${a.cardId} 回到初始位置: (${r.value.x}, ${r.value.y})`),s.value={...r.value}),u.style.zIndex="",u.style.opacity="1",u.style.transition="transform 0.1s ease, opacity 0.2s ease",document.querySelectorAll('.card-slot[data-is-empty="true"]').forEach(p=>{p.classList.remove("drop-allowed")}),document.querySelectorAll(".tavern-section").forEach(p=>{p.classList.remove("drop-allowed")}),document.querySelectorAll(".hand-section").forEach(p=>{p.classList.remove("drop-allowed")})}}}))}),N(()=>{m&&m.unset()}),(y,i)=>(v(),b("div",{ref_key:"cardRef",ref:R,class:q(["card-slot",[`position-${a.positionType}`,{empty:a.data===null||a.data===void 0}]]),"data-x":s.value.x,"data-y":s.value.y,"data-position-type":a.positionType,"data-is-empty":a.data===null||a.data===void 0,style:P({transform:`translate(${s.value.x}px, ${s.value.y}px)`})},[f("span",null,V(A.data.id.slice(-10)),1)],14,Y))}}),D=L(j,[["__scopeId","data-v-d41a2b08"]]),H={class:"vertical-hearthstone"},K={class:"game-container"},U={class:"card-row"},G={class:"card-row"},J={class:"game-section battlefield-section"},O={class:"card-row"},Q={class:"card-row"},W={class:"card-row"},Z={class:"card-row"},tt=B({__name:"index",setup(A){const $=_(!1),a=_(!1),h=_(null),s=T([]),r=T([]),d=T([]);(()=>{for(let e=1;e<=5;e++)s.push({id:`tavern-1-${e}`,position:"酒馆"});for(let e=1;e<=2;e++)s.push({id:`tavern-2-${e}`,position:"酒馆"});for(let e=1;e<=5;e++)r.push(null);for(let e=1;e<=2;e++)r.push(null);for(let e=1;e<=5;e++)d.push(null);for(let e=1;e<=5;e++)d.push(null)})();const m=e=>{let o=null;o=[...s,...r,...d].find(c=>c&&c.id===e)||null,h.value=e,o?.position==="酒馆"?($.value=!0,a.value=!1):o?.position==="战场"?($.value=!1,a.value=!0):($.value=!1,a.value=!1),console.log(`[父组件] 开始拖拽卡片: ${e}, 当前位置: ${o?.position}, 手牌高亮: ${$.value}, 酒馆高亮: ${a.value}`)},y=(e,o)=>{console.log(`[父组件] 拖拽结束: 卡片 ${e}, 目标区域: ${o||"非手牌区域"}`),$.value=!1,a.value=!1,h.value=null},i=(e,o,t)=>{console.log(`[父组件] 卡片移动事件: 卡片 ${e} 从 ${o} 移动到 ${t}`);let l=null,c=[];o==="酒馆"?c=s:o==="战场"?c=r:o==="手牌"&&(c=d);const C=c.findIndex(g=>g&&g.id===e);if(C>-1&&(l=c.splice(C,1)[0]||null,l)){let g=[];t==="酒馆"?g=s:t==="战场"?g=r:t==="手牌"&&(g=d),l.position=t;const S=g.findIndex(w=>w===null);S>-1?g[S]=l:g.push(l),console.log(`[父组件] 卡片位置更新: 卡片 ${e} 位置从 ${o} 变为 ${t}`),console.log(`[父组件] 当前卡片分布: 酒馆 ${s.length}, 战场 ${r.length}, 手牌 ${d.length}`)}},u=e=>{console.log(`[父组件] 卡片移除事件: 卡片 ${e} 被移除`);const o=[s,r,d];for(const t of o){const l=t.findIndex(c=>c&&c.id===e);if(l>-1){const c=t.splice(l,1)[0];c&&(t.splice(l,0,null),console.log(`[父组件] 卡片 ${c.id} 已从 ${c.position} 区域移除`));break}}console.log(`[父组件] 当前卡片分布: 酒馆 ${s.length}, 战场 ${r.length}, 手牌 ${d.length}`)};return M([s,r,d],([e,o,t])=>{console.log("[父组件] 卡片数据变化:",{tavern:e,battlefield:o,hand:t})},{deep:!0}),(e,o)=>(v(),b("div",H,[f("div",K,[f("div",{class:q(["game-section tavern-section",{"drop-allowed":a.value}])},[f("div",U,[(v(!0),b(x,null,I(s.slice(0,5),(t,l)=>(v(),E(D,{key:t?t.id:"empty-tavern-1-"+l,"card-id":t?t.id:"empty-tavern-1-"+l,"position-type":"酒馆",data:t,onDragStart:m,onDragEnd:y,onCardMove:i,onCardRemove:u},null,8,["card-id","data"]))),128))]),f("div",G,[(v(!0),b(x,null,I(s.slice(5,7),(t,l)=>(v(),E(D,{key:t?t.id:"empty-tavern-2-"+l,"card-id":t?t.id:"empty-tavern-2-"+l,"position-type":"酒馆",data:t,onDragStart:m,onDragEnd:y,onCardMove:i,onCardRemove:u},null,8,["card-id","data"]))),128)),o[0]||(o[0]=X('<div class="info-panel tavern-info" data-v-16d202a0><div class="stats-row" data-v-16d202a0><div data-v-16d202a0>酒馆等级：1级</div><button data-v-16d202a0>升级(1)</button></div><div class="buttons-row" data-v-16d202a0><div data-v-16d202a0>第x回合</div><button data-v-16d202a0>刷新(1)</button><button data-v-16d202a0>冻结(0)</button></div><div class="stats-row" data-v-16d202a0><div data-v-16d202a0>生命值：30 护甲：7</div><button data-v-16d202a0>技能</button></div><div class="buttons-row" data-v-16d202a0><div data-v-16d202a0>铸币：10/10</div><button data-v-16d202a0>设置</button><button data-v-16d202a0>调试</button></div></div>',1))])],2),f("div",J,[f("div",O,[(v(!0),b(x,null,I(r.slice(0,5),(t,l)=>(v(),E(D,{key:t?t.id:"empty-battlefield-1-"+l,"card-id":t?t.id:"empty-battlefield-1-"+l,"position-type":"战场",data:t,onDragStart:m,onDragEnd:y,onCardMove:i,onCardRemove:u},null,8,["card-id","data"]))),128))]),f("div",Q,[(v(!0),b(x,null,I(r.slice(5,7),(t,l)=>(v(),E(D,{key:t?t.id:"empty-battlefield-2-"+l,"card-id":t?t.id:"empty-battlefield-2-"+l,"position-type":"战场",data:t,onDragStart:m,onDragEnd:y,onCardMove:i,onCardRemove:u},null,8,["card-id","data"]))),128)),o[1]||(o[1]=f("div",{class:"info-panel player-info"},[f("div",null,"选中的卡片信息")],-1))])]),f("div",{class:q(["game-section hand-section",{"drop-allowed":$.value}])},[f("div",W,[(v(!0),b(x,null,I(d.slice(0,5),(t,l)=>(v(),E(D,{key:t?t.id:"empty-hand-1-"+l,"card-id":t?t.id:"empty-hand-1-"+l,"position-type":"手牌",data:t,onDragStart:m,onDragEnd:y,onCardMove:i,onCardRemove:u},null,8,["card-id","data"]))),128))]),f("div",Z,[(v(!0),b(x,null,I(d.slice(5,10),(t,l)=>(v(),E(D,{key:t?t.id:"empty-hand-2-"+l,"card-id":t?t.id:"empty-hand-2-"+l,"position-type":"手牌",data:t,onDragStart:m,onDragEnd:y,onCardMove:i,onCardRemove:u},null,8,["card-id","data"]))),128))])],2)])]))}}),st=L(tt,[["__scopeId","data-v-16d202a0"]]);export{st as default};
