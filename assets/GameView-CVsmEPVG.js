import{d as P,i as F,c as p,o as c,m as j,a as l,j as T,t as h,k as G,_ as N,l as k,n as B,F as D,r as H,h as w,p as O,b as d,f as R,g as U,q as J}from"./index-CJl8y-If.js";import{u as A,D as q,h as V,P as W,T as K,A as Q,m as E,a as X}from"./MinionClassMap-BjwAcJij.js";const Y={class:"corner-circle top-left"},Z={class:"circle-text big"},ee={key:0,class:"corner-circle top-right"},te={class:"circle-text big"},se={class:"card-name"},ne={class:"card-content"},ae={key:1,class:"card-bottom"},re={class:"corner-circle bottom-left"},oe={class:"circle-text attack"},ie={class:"bottom-texts"},le={key:0,class:"text-item"},ce={class:"corner-circle bottom-right"},de={class:"circle-text health"},ue=P({__name:"HearthstoneCard",props:{card:{},isSelected:{type:Boolean},isHighlighted:{type:Boolean},isDragging:{type:Boolean},index:{},source:{}},emits:["click","card-selected"],setup(x,{emit:e}){const u=A(),a=x,M=e,f=()=>{a.card&&(a.card.cardType==="minion"?u.selectMinion(a.card,a.index||0,a.source||"hand"):a.card.cardType==="spell"&&u.selectSpell(a.card,a.index||0),M("card-selected",a.card,a.index))},_=m=>{f(),M("click",m)},i=F(!1),g=F(!1),o=m=>{let $=null,I="minion";if(a.card&&($=a.card,I=a.card.cardType),!$){m.preventDefault();return}if(i.value=!0,m.dataTransfer&&m.target){const v=document.createElement("div");v.className="hearthstone-card-drag-image",v.textContent=a.card?.name||"Card",v.style.position="absolute",v.style.top="-1000px",v.style.left="-1000px",v.style.width="150px",v.style.height="200px",v.style.border="2px solid #000",v.style.backgroundColor="#e0e0e0",v.style.borderRadius="8px",v.style.display="flex",v.style.alignItems="center",v.style.justifyContent="center",v.style.fontSize="16px",v.style.fontWeight="bold",document.body.appendChild(v),m.dataTransfer.setDragImage(v,75,100),setTimeout(()=>{document.body.removeChild(v)},0)}if(I==="spell")u.startSpellDrag(m,$,a.index||0),m.preventDefault();else{const v={source:a.source||"hand",index:a.index||0,cardId:$.id||$.instanceId,strId:$.strId,cardType:I};console.log(`[拖拽开始] 从${v.source}拖拽第${v.index}个位置的${v.cardType}`),m.dataTransfer?.setData("text/plain",JSON.stringify(v))}},n=()=>{i.value=!1},t=()=>{g.value=!0},s=()=>{g.value=!1},r=()=>a.card?.cardType==="minion"?a.card.tier:2,b=()=>a.card?a.card.cost:1,S=()=>a.card?a.card.nameCN:"名称",y=()=>a.card?.cardType==="minion"?a.card.attack:999999,C=()=>a.card?.cardType==="minion"?a.card.health:999999,L=()=>a.card?.cardType==="minion"?a.card.minionTypesCN?.join("/"):null;return(m,$)=>a.card?(c(),p("div",j({key:0,class:["hearthstone-card",{selected:x.isSelected,highlighted:x.isHighlighted,dragging:i.value}],onClick:_,draggable:"true",onDragstart:o,onDragend:n,onMouseenter:t,onMouseleave:s},m.$attrs),[l("div",Y,[l("span",Z,h(r()),1)]),a.source==="tavern"?(c(),p("div",ee,[l("span",te,h(b()),1)])):T("",!0),l("div",se,h(S()),1),l("div",ne,[G(m.$slots,"default",{},void 0)]),a.card?.cardType==="minion"?(c(),p("div",ae,[l("div",re,[l("span",oe,h(y()),1)]),l("div",ie,[L()?(c(),p("span",le,h(L()),1)):T("",!0)]),l("div",ce,[l("span",de,h(C()),1)])])):T("",!0)],16)):(c(),p("div",j({key:1,class:["hearthstone-card hearthstone-card-empty",m.$attrs.class]},m.$attrs)," 空 ",16))}}),z=N(ue,[["__scopeId","data-v-a2af49c9"]]),ge={class:"row battlefield-container"},pe=P({__name:"HearthstoneBattlefield",setup(x){const e=A(),u=k(()=>e.player),a=F(null),M=(n,t,s,r)=>{a.value=s,n.dataTransfer&&r&&n.dataTransfer.setData("text/plain",JSON.stringify({source:t,index:s,card:r}))},f=k(()=>u.value?.minions||[]),_=(n,t)=>{n.preventDefault()},i=(n,t)=>{n.preventDefault();const s=n.dataTransfer?.getData("text/plain");if(s)try{const r=JSON.parse(s);if(r.source==="hand"){let b=0;const S=f.value;if(typeof t=="number"){if(!S?.[t])b=t;else for(let y=0;y<7;y++)if(!S?.[y]){b=y;break}}else for(let y=0;y<7;y++)if(!S?.[y]){b=y;break}S.some(y=>y===null)&&e.placeMinionFromHand(r.index,b)}else if(r.source==="battlefield"&&typeof t=="number"){const b=t;a.value!==null&&a.value!==b&&(e.reorderMinions(a.value,b),e.selectedMinionIndex===a.value&&(e.selectedMinionIndex=b)),a.value=null}}catch{}},g=(n,t)=>{if(n)if(e.spellUsageState==="selecting_target"&&e.selectedSpell){const s=e.highlightedTargets.find(r=>r.source==="battlefield"&&r.index===t&&r.target===n);s&&e.selectSpellTarget(s)}else e.selectMinion(n,t,"battlefield")},o=(n,t,s)=>!e.selectedSpell||e.spellUsageState!=="selecting_target"?!1:e.highlightedTargets.some(r=>r.source===t&&r.index===s&&r.target===n);return(n,t)=>(c(),p("div",ge,[l("div",{class:"player-minions",onDragover:t[0]||(t[0]=B(()=>{},["prevent"]))},[(c(),p(D,null,H(7,s=>w(z,{key:s,card:f.value?.[s-1]||null,index:s-1,source:"battlefield","is-selected":!!(f.value?.[s-1]&&d(e).selectedMinion?.instanceId===f.value[s-1]?.instanceId),"is-highlighted":!!(f.value?.[s-1]&&o(f.value[s-1],"battlefield",s-1)),class:O({empty:!f.value?.[s-1]}),onClick:r=>g(f.value?.[s-1]||void 0,s-1),draggable:!!f.value?.[s-1],onDragstart:r=>M(r,"battlefield",s-1,f.value?.[s-1]||void 0),onDragover:B(r=>_(r),["prevent"]),onDrop:B(r=>i(r,s-1),["prevent"])},null,8,["card","index","is-selected","is-highlighted","class","onClick","draggable","onDragstart","onDragover","onDrop"])),64))],32)]))}}),ve=N(pe,[["__scopeId","data-v-692d33af"]]),he={class:"row"},fe={class:"row"},_e=P({__name:"HearthstoneHand",setup(x){const e=A(),u=k(()=>e.player),a=k(()=>u.value?.cards?u.value.cards.slice(0,5):[]),M=k(()=>u.value?.cards?u.value.cards.slice(5,10):[]),f=k(()=>{const n=a.value.length;return Math.max(0,5-n)}),_=k(()=>{const n=M.value.length;return Math.max(0,5-n)}),i=(o,n)=>{console.log(`选择了手牌中的第${n}个位置的卡片:`,o)},g=(o,n)=>{o.preventDefault();const t=o.dataTransfer?.getData("text/plain");if(t)try{const s=JSON.parse(t);if(console.log(`[拖拽放置] 从${s.source}拖拽第${s.index}个位置的卡牌到手牌`),s.source==="tavern"&&n==="hand"){const r=s.index;console.log(`[购买随从] 尝试购买酒馆第${r}个位置的随从`);const b=e.buyMinion(r);console.log(`[购买结果] ${b?"购买成功":"购买失败，可能是金币不足或手牌已满"}`)}}catch{}};return(o,n)=>(c(),p("div",{class:"right-subsection",onDragover:n[0]||(n[0]=B(()=>{},["prevent"])),onDrop:n[1]||(n[1]=t=>g(t,"hand"))},[l("div",he,[(c(!0),p(D,null,H(a.value,(t,s)=>(c(),R(z,{key:t?.id||`card-${s}`,card:t,index:s,source:"hand",onClick:r=>i(t,s)},null,8,["card","index","onClick"]))),128)),(c(!0),p(D,null,H(f.value,t=>(c(),R(z,{key:`empty-top-${t}`,card:null,index:t+(u.value?.cards.length||0),source:"hand"},null,8,["index"]))),128))]),l("div",fe,[(c(!0),p(D,null,H(M.value,(t,s)=>(c(),R(z,{key:t?.id||`card-${s+5}`,card:t,index:s+5,source:"hand",onClick:r=>i(t,s+5)},null,8,["card","index","onClick"]))),128)),(c(!0),p(D,null,H(_.value,t=>(c(),R(z,{key:`empty-bottom-${t}`,card:null,index:t+5+Math.min(u.value?.cards.length||0,5),source:"hand"},null,8,["index"]))),128))])],32))}}),ye=N(_e,[["__scopeId","data-v-08bae8f1"]]),be=P({__name:"HearthstoneTavern",setup(x){const e=A();console.log(e);const u=k(()=>e.tavern),a=(i,g)=>{if(e.spellUsageState==="selecting_target"&&e.selectedSpell){const o=e.highlightedTargets.find(n=>n.source==="tavern"&&n.index===g&&n.target===i);o&&e.selectSpellTarget(o)}},M=(i,g,o)=>!e.selectedSpell||e.spellUsageState!=="selecting_target"?!1:e.highlightedTargets.some(n=>n.source===g&&n.index===o&&n.target===i),f=i=>{i.preventDefault()},_=(i,g)=>{i.preventDefault();const o=i.dataTransfer?.getData("text/plain");if(o)try{const n=JSON.parse(o);n.source==="battlefield"&&g==="tavern"&&e.sellMinion("minion",n.index)}catch{}};return(i,g)=>(c(),p("div",{class:"row",onDragover:B(f,["prevent"]),onDrop:g[0]||(g[0]=o=>_(o,"tavern"))},[(c(),p(D,null,H(7,o=>w(z,{key:`tavern-${o}`,card:u.value?.availableMinions?.[o-1],index:o-1,"is-selected":d(e).selectedMinion?.instanceId===u.value?.availableMinions?.[o-1]?.instanceId,"is-highlighted":M(u.value?.availableMinions?.[o-1],"tavern",o-1),onClick:n=>a(u.value?.availableMinions?.[o-1],o-1),source:"tavern"},null,8,["card","index","is-selected","is-highlighted","onClick"])),64))],32))}}),me=N(be,[["__scopeId","data-v-df12919e"]]),Me={class:"large-cell"},Ce={class:"tavern-info"},ke={class:"tavern-level big-size"},Se=["disabled"],Te=["disabled"],xe={class:"player-stats"},$e={class:"health-armor big-size"},De={class:"coins big-size"},we={class:"big-size"},He={key:0,class:"card-info"},ze={class:"card-left"},Pe={class:"card-name big-size"},Ne={class:"card-name big-size"},Ae={class:"card-level big-size"},Be={class:"card-cost big-size"},Le={key:0,class:"card-attack big-size"},Re={key:1,class:"card-health big-size"},Fe={key:2,class:"card-type big-size"},Ie={class:"card-right"},Ve=["innerHTML"],je=["innerHTML"],Ee={class:"action-buttons"},Ge={class:"cost"},Oe=P({__name:"ActionArea",setup(x){const e=A(),u=F(!1),a=()=>{u.value=!0},M=()=>{u.value=!1},f=k(()=>{if(!e.player)return!1;const C=[0,5,7,8,10,12,12][e.player.tavernLevel]||0;return e.player.gold>=C&&e.player.tavernLevel<6}),_=k(()=>e.player&&[0,5,7,8,10,12,12][e.player.tavernLevel]||0),i=()=>{e.upgradeTavern()},g=()=>{e.refreshTavern()},o=()=>{e.tavern?.isFrozen?e.unfreezeTavern():e.freezeTavern()},n=k(()=>e.selectedMinion||e.selectedSpell),t=k(()=>e.selectedMinion?e.selectedMinion.cardType==="minion"?"随从":"其他":e.selectedSpell?e.selectedSpell.type==="shaping"?"法术/塑造法术":"法术":"随从/塑造法术"),s=()=>{e.endTurn()},r=()=>{e.selectedMinion&&(e.buyMinion(e.selectedMinionIndex||0),e.cancelSelectMinion())},b=()=>{e.selectedMinion&&e.selectedMinionIndex!==null&&(e.sellMinion("minion",e.selectedMinionIndex),e.cancelSelectMinion())},S=()=>{e.selectedMinion&&e.selectedMinionIndex!==null&&(e.placeMinionFromHand(e.selectedMinionIndex,0),e.cancelSelectMinion())};return(y,C)=>(c(),p(D,null,[l("div",Me,[l("div",Ce,[l("div",ke,"酒馆等级："+h(d(e).player?.tavernLevel||1),1),l("button",{class:"action-button big-size",disabled:!f.value,onClick:i}," 升级("+h(_.value)+") ",9,Se),l("button",{class:"action-button big-size",disabled:!(d(e).player&&d(e).player.gold>=1),onClick:g}," 刷新(1) ",8,Te),l("button",{class:"action-button big-size",onClick:o},h(d(e).tavern?.isFrozen?"解冻(1)":"冻结(1)"),1)]),l("div",xe,[l("div",$e," 生命值："+h(d(e).player?.hero?.health||30)+" 护甲："+h(d(e).player?.hero?.armor||0),1),l("div",De," 铸币："+h(d(e).player?.gold||0)+"/"+h(d(e).player?.maxGold||10),1),l("div",we,"第"+h(d(e).currentTurn||1)+"回合",1)]),n.value?(c(),p("div",He,[l("div",ze,[l("div",Pe,"名称："+h(n.value?.name||""),1),l("div",Ne,"类型："+h(t.value),1),l("div",Ae,"等级："+h(n.value?.tier||1),1),l("div",Be,"花费："+h(n.value?.cost||1),1),d(e).selectedMinion?(c(),p("div",Le," 攻击："+h(d(e).selectedMinion.attack||0),1)):T("",!0),d(e).selectedMinion?(c(),p("div",Re," 生命值："+h(d(e).selectedMinion.health||0),1)):T("",!0),d(e).selectedMinion?(c(),p("div",Fe," 类型："+h(d(e).selectedMinion.minionTypesCN?.join(" | ")||""),1)):T("",!0)]),l("div",Ie,[l("div",{class:"card-description big-size",innerHTML:n.value?.text||""},null,8,Ve),d(e).selectedSpell?(c(),p("div",{key:0,class:"card-effects big-size",innerHTML:"法术效果："+(d(e).selectedSpell.text||"无描述")},null,8,je)):T("",!0)])])):T("",!0),l("div",Ee,[d(e).selectedMinionSource==="tavern"?(c(),p("button",{key:0,class:"action-button big-size",onClick:r},[C[1]||(C[1]=U(" 购买 ",-1)),l("span",Ge,"("+h(d(e).selectedMinion?.cost||0)+")",1)])):T("",!0),d(e).selectedMinionSource==="hand"?(c(),p("button",{key:1,class:"action-button big-size",onClick:S}," 放置随从 ")):T("",!0),d(e).selectedMinionSource==="battlefield"?(c(),p("button",{key:2,class:"action-button big-size",onClick:b}," 出售 ")):T("",!0),l("button",{class:"action-button big-size",onClick:s},"结束回合"),C[2]||(C[2]=l("button",{class:"action-button big-size"},"设置按钮",-1)),l("button",{class:"action-button big-size",onClick:a},"调试按钮")])]),w(q,{"debug-drawer-visible":u.value,"onUpdate:debugDrawerVisible":C[0]||(C[0]=L=>u.value=L),"game-state":d(e).gameState,"current-turn":d(e).currentTurn,onClose:M},null,8,["debug-drawer-visible","game-state","current-turn"])],64))}}),Ue=N(Oe,[["__scopeId","data-v-7f3777c8"]]),Je={class:"main-frame",id:"game-main"},qe={class:"top-section"},We={class:"bottom-section"},Ke=P({__name:"GameView",setup(x){const e=A(),u=()=>{const g=[...V].sort(()=>.5-Math.random()).slice(0,3);e.setAvailableHeroes(g)},a=()=>{const _=Object.keys(E),i=t=>{let s=[];return t.forEach(r=>{s.push(r),r.tokens&&Array.isArray(r.tokens)&&(s=s.concat(i(r.tokens))),r.upgradeCard&&(s.push(r.upgradeCard),r.upgradeCard.tokens&&Array.isArray(r.upgradeCard.tokens)&&(s=s.concat(i(r.upgradeCard.tokens))))}),s},o=i(X).filter(t=>t.cardType==="minion"&&_.includes(t.strId)).map(t=>{const s=E[t.strId];if(s)try{return new s(t.id,t.strId,t.cardType,t.name,t.nameCN,t.text,t.mechanics||[],t.referencedTags||[],t.img,t.art,t.tier,t.health,t.attack,t.minionTypes||[],t.minionTypesCN||[],t.upgradeCard)}catch(r){return console.error(`创建随从 ${t.strId} 实例时出错:`,r),null}return null}).filter(t=>t!==null);return{globalMinionPool:o,tavernMinionPool:o}},M=_=>{const{globalMinionPool:i,tavernMinionPool:g}=a(),o=_.heroPowerList?.[0]||{name:"未知技能",text:"无描述",manaCost:0},n={..._,heroPower:{name:o.name,description:o.text,type:"active",cost:o.manaCost,cooldown:0,currentCooldown:0,use:()=>{}}},t=new W("player-1",n,!0),s=new K(1,g);s.refresh();const r=[];for(let b=0;b<7;b++){const S=V[b%V.length],y=S.heroPowerList?.[0]||{name:"未知技能",text:"无描述",manaCost:0},C={...S,heroPower:{name:y.name,description:y.text,type:"active",cost:y.manaCost,cooldown:0,currentCooldown:0,use:()=>{}}};r.push(new Q(`ai-${b+1}`,C))}e.initGame(t,s,r,i)},f=_=>{const i=e.availableHeroes.find(g=>g.id===_);i&&(e.selectHero(i),M(i),console.log("选择了英雄:",i.name))};return J(()=>{if(u(),e.availableHeroes.length>0){const _=Math.floor(Math.random()*e.availableHeroes.length),i=e.availableHeroes[_];i&&(f(i.id),console.log("页面加载时随机选择了英雄:",i.name||"未知英雄"))}}),(_,i)=>(c(),p("div",Je,[l("div",qe,[w(me),w(ve)]),l("div",We,[w(Ue),w(ye)])]))}}),Ye=N(Ke,[["__scopeId","data-v-730fe6fe"]]);export{Ye as default};
